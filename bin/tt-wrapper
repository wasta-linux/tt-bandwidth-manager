#!/bin/bash

# Select device based on current internet route.
#   ip route's default isn't the real gateway when there's a WireGuard VPN interface
real_gw=$(traceroute -m1 -n google.com | tail -n1 | awk '{print $2}')
device=$(ip route | grep "$real_gw " | sed -r 's/default via //' | awk '{print $3}')
echo "Setup.device: $device"

# Define default config.
config="/etc/tt-config.yaml"
echo "Setup.config: $config"

# Start TrafficToll.
/usr/bin/tt "$device" "$config"
