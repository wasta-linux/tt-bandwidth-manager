#!/bin/bash

# Select device based on current internet route.
device=$(ip route | grep 'default' | awk '{print $5}')

# Define default config.
config="/usr/share/tt-bandwidth-manager/tt-config.yaml"

# Override with user config, if it exists.
# Get [potential list of] user config file(s) and sort by modified time, newest first.
user_config_list=$(find /home/*/.config -name tt-config.yaml \
    -exec stat -c '%Y|%n' '{}' \; | sort -rn | awk -F'|' '{print $2}')
# Choose newest file as preferred user config.
user_config=$(echo $user_config_list | awk '{print $1}')
echo "User config (if found): $user_config"
if [[ -r $user_config ]]; then
    config="$user_config"
fi
echo "Config used: $config"

/usr/local/bin/tt "$device" "$config"
